# Pair Trading for Machine Learning


The idea of this project was to develop a trading strategy for portfolio optimization leveraging statistical arbitrage technique, also called Pair Trading. A pairs trade is a trading strategy commonly used in hedge funds and investment banks that involves matching a long position with a short position in two stocks with high correlation. The major aspects of this strategy are optimal stock pair selection and the spread analysis/prediction amongst a pair of selected stocks. The aim here is to optimize the traditional approach of pair trading by optimizing the pair selection process, replacing the traditional statistical model with an advanced machine learning method, and developing an optimal trading strategy.

To leverage the strategy the financial data for S&P 500 companies of last 5 years was scraped from Yahoo Finance utilizing company tickers extracted from Wikipedia as identifiers. In order to optimize the data collection, a multithreaded approach was undertaken to enable asynchronous collection reducing the time taken by 60%. The data was stock-wise analyzed to detect missing values and median value imputation was applied for each stock. The clean data was stored as parquet files to be easily queryable using Spark queries. Feature engineering was a crucial step to extract more insights from the data in hand, for which additional technical indicators such as Relative Strength Index, Moving Averages, and Volume Price trend, were calculated. These technical indicators played a significant role in enhancing the final trading strategy.

As per the financial studies, identifying optimal correlated pairs is a crucial task and plays an important role in developing the trading strategy. Conventionally the cointegration tests aid to identify correlated pairs however it is computationally expensive, to overcome this hurdle cluster analysis was performed using clustering techniques such as K-Means, Hierarchical, and Affinity propagation clustering, which optimized the pair selection process transforming the search space to significant clusters instead whole data. 

Once the significantly correlated pairs were identified a modeling strategy called Spread Forecasting to predict the stock prices up to 1- and 5- timesteps ahead. The traditional approaches to perform Spread forecasting are ARIMA, VAR, and Kalman filters but their performances are limited for performing short-term forecasting. To enable long-term forecasting a custom LSTM model was developed. LSTM models are capable of learning long-term dependencies. The architecture consisted of 2 stacked LSTM neural layers followed by a fully connected layer and is used to predict the value of spread 1-time step in the future. Mean Squared error was used as an evaluation metric for the model performances, which also validated better performance by LSTM as compared to traditional approaches.

The spread predictions were used to develop a simple trading strategy used to generate optimal buy and sell signals for stocks. The normalized spread was evaluated and significant deviations of the spread from the mean were noted to generate signals for shorting a position in the overvalued stock, i.e. Sell signal for outperforming stock and longing a position in the undervalued stock, i.e. Buy signal for the underperforming stock. The trading strategy was evaluated by estimating profits gained by simulating trades by implementing the strategy starting with no positions in any stock of the pair and building up from there. Testing was performed on 10 stock pairs, and the trading strategy utilizing LSTM predictions was found to be able to generate profits 30% upwards of the traditional pair trading approaches. This project showcases the ability of advanced machine learning approaches to address the current drawbacks of traditional approaches and the great amount of value they could bring to business portfolios. 
